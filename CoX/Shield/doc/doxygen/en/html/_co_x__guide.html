<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<title>COX Shield: How to</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="coocox_logo.png"/></td>
  <td style="padding-left: 0.5em;">
   <div id="projectname">COX Shield
   &#160;<span id="projectnumber">V2.0.0</span>
   </div>
   <div id="projectbrief">API Reference</div>
  </td>
   <td>        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
</td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.2 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('_co_x__guide.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Data Structures</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Groups</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Pages</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">How to </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><h1>Contents</h1>
<ul>
<li><a class="el" href="_co_x__guide.html#CoX_Guide_Howto">1. How to use CoX Peripheral Library?</a><ul>
<li><a class="el" href="_co_x__guide.html#CoX_Guide_Howto_Step">1.1 Step of using CoX Peripheral Library?</a></li>
<li><a class="el" href="_co_x__guide.html#CoX_Guide_Howto_Shortpin">1.2 How to use GPIO shortpin(PA0) feature?</a><ul>
<li><a class="el" href="_co_x__guide.html#CoX_Guide_Howto_Shortpin_What">1.2.1 What is a GPIO shortpin?</a></li>
<li><a class="el" href="_co_x__guide.html#CoX_Guide_Howto_Shortpin_When">1.2.2 When to use the shortpin feature?</a></li>
<li><a class="el" href="_co_x__guide.html#CoX_Guide_Howto_Shortpin_How">1.2.3 How to use the shortpin feature?</a></li>
</ul>
</li>
<li><a class="el" href="_co_x__guide.html#CoX_Guide_Howto_Int">1.3 How to use the CoX interrupt feature?</a></li>
<li><a class="el" href="_co_x__guide.html#CoX_Guide_Howto_Peripheral">1.4 How to Use the Peripheral?</a></li>
<li><a class="el" href="_co_x__guide.html#CoX_Guide_Howto_More_Portable">1.5 Make your code be ported more easily based on CoX</a></li>
<li><a class="el" href="_co_x__guide.html#CoX_Guide_Howto_Code_Standard">1.6. Code Standard in CoX</a><ul>
<li><a class="el" href="_co_x__guide.html#CoX_Guide_Howto_Code_Name">1.6.1 Naming</a></li>
<li><a class="el" href="_co_x__guide.html#CoX_Guide_Howto_Code_doxygen">1.6.2 Doxygen</a></li>
</ul>
</li>
</ul>
</li>
<li><a class="el" href="_co_x__guide.html#CoX_Guide_Port">2. How to Port CoX to other MCU platforms?</a></li>
</ul>
<p><br/>
</p>
<h1><a class="anchor" id="CoX_Guide_Howto"></a>
1. How to use CoX Peripheral Library?</h1>
<h2><a class="anchor" id="CoX_Guide_Howto_Step"></a>
1.1 Step of using CoX Peripheral Library?</h2>
<ol type="1">
<li>Select the CoX implmentation according to the selected MCU, such as <b>NUC1xx</b> CoX Peripheral Library. copy the libcox, startup to your workdir.</li>
<li>Determine the compiler IDE, such as MDK, add startup_rvmdk.s to your project.</li>
<li>Define preprocessor symbols to tell the CoX that which compiler you use:<ul>
<li><b>gcc</b> - CooCox CoIDE(GCC).</li>
<li><b>ewarm</b> - IAR EWARM.</li>
<li><b>rvmdk</b> - Keil MDK.</li>
</ul>
</li>
<li>Define preprocessor symbols <b>xDebug</b> to enable the CoX debug feature, <a class="el" href="group__x_debug___exported___a_p_is.html#gac3614ce0ffa3ae3fbb59909701bd51c1">xASSERT</a> to assert some conditions.</li>
<li>Include the header file :<ul>
<li><a class="el" href="xhw__types_8h.html">xhw_types.h</a></li>
<li><a class="el" href="xhw__memmap_8h.html">xhw_memmap.h</a></li>
<li><a class="el" href="xhw__ints_8h.html">xhw_ints.h</a></li>
<li><a class="el" href="xgpio_8h.html">xgpio.h</a> or the peripheral that you use.</li>
</ul>
</li>
<li>APIs with a prefix <b>x</b>, are the CoX unified interface, which are compatible with a variety of MCUs.</li>
<li>APIs without the prefix <b>x</b>, are for special MCU features. The library also implement fully functions of the MCU peripheral.</li>
<li>Write your applications.</li>
</ol>
<h2><a class="anchor" id="CoX_Guide_Howto_Shortpin"></a>
1.2 How to use GPIO shortpin(PA0) feature?</h2>
<h3><a class="anchor" id="CoX_Guide_Howto_Shortpin_What"></a>
1.2.1 What is a GPIO shortpin?</h3>
<p>A GPIO pin always contains info of a GPIO port(GPIO_PORTA_BASE), and a GPIO Pin(GPIO_PIN_0).</p>
<p>A GPIO shortpin in cox is <b>a</b> macro contained port, pin information in one body. PA0, A indicates GPIO_PortA_BASE, 0 indicates GPIO_PIN_0.</p>
<h3><a class="anchor" id="CoX_Guide_Howto_Shortpin_When"></a>
1.2.2 When to use the shortpin feature?</h3>
<ul>
<li>When you just operate a pin in the port.</li>
<li>When a driver device uses a GPIO pin.</li>
<li>The more simple AFIO operation, such as <a class="el" href="group__x_g_p_i_o___exported___a_p_is.html#ga051f450e2a2b4170457a926165e447c9" title="Turn a pin to a GPIO CAN input or output pin.">xSPinTypeCAN(CAN0RX, PA4)</a>;</li>
<li>...</li>
</ul>
<h3><a class="anchor" id="CoX_Guide_Howto_Shortpin_How"></a>
1.2.3 How to use the shortpin feature?</h3>
<p>Use the shortpin to read/write:</p>
<ul>
<li><a class="el" href="group__x_g_p_i_o___exported___a_p_is.html#ga9dbba553de6cd348884c34a97dd2361b" title="Write a value to the specified pin.">xGPIOSPinWrite(PA3, 0)</a>;</li>
<li>ulPinState = <a class="el" href="group__x_g_p_i_o___exported___a_p_is.html#ga06bd0446df2256361925cc97fb1aff93" title="Reads the values present of the specified pin.">xGPIOSPinRead(PA3)</a>;</li>
</ul>
<p>Use the shortpin AFIO operation:</p>
<ul>
<li><a class="el" href="group__x_g_p_i_o___exported___a_p_is.html#ga051f450e2a2b4170457a926165e447c9" title="Turn a pin to a GPIO CAN input or output pin.">xSPinTypeCAN(CAN0RX, PA4)</a>;</li>
<li><a class="el" href="group__x_g_p_i_o___exported___a_p_is.html#ga5c0278f15319393bc656b54079135fd5" title="Turn a pin to a GPIO ADC input pin.">xSPinTypeADC()</a> ...</li>
</ul>
<p>Use the shortpin in a device driver: </p>
<div class="fragment"><div class="line"><span class="preprocessor">#define SPI_FLASH_PIN_CS  PC2</span></div>
<div class="line"><span class="preprocessor"></span></div>
<div class="line"><a class="code" href="group__x_g_p_i_o___exported___a_p_is.html#ga9dbba553de6cd348884c34a97dd2361b" title="Write a value to the specified pin.">xGPIOSPinWrite</a>(SPI_FLASH_PIN_CS, 0);</div>
</div><!-- fragment --><p>There is also APIs to get the Port, Pin:</p>
<ul>
<li>xSPintoPort(PA0); - result is GPIO_PIN_0</li>
<li>xSPintoPin(PA0); - result is GPIO_PORTA_BASE</li>
<li>xSPintoPortPin(PA0), in a struct - result like: GPIO_PORTA_BASE, GPIO_PIN_0,</li>
</ul>
<h2><a class="anchor" id="CoX_Guide_Howto_Int"></a>
1.3 How to use the CoX interrupt feature?</h2>
<p>CoX unified defines the interruption of peripherals Compatible with a variety of MCUs using a callback function with an event ID.</p>
<p>Users should use the Event ID, not the interrupt flags in the MCU peripherals.</p>
<p>Users should also use the callback function instead of the interrupt Handler function defined in the vector table.</p>
<p>Step of Using the interrupt feature:</p>
<ol type="1">
<li><a class="el" href="group__x_s_p_i___exported___a_p_is.html#ga7484dce4d8c80b4e021cee1512416c2b" title="Init interrupts callback for the specified SPI Port.">xSPIIntCallbackInit()</a> Init the callback function.</li>
<li><a class="el" href="group__x_s_p_i___exported___a_p_is.html#gaaf1fc3c0f7455f832e753d68607429ce" title="Enable the SPI interrupt of the specified SPI port.">xSPIIntEnable()</a> to enable the interrupt.</li>
<li><a class="el" href="group__x_c_o_r_e___exported___a_p_is.html#ga1d1c076c748565e109f8abad14dda0bf" title="Enables an interrupt.">xIntEnable()</a> to enable the interrupt in the NVIC level.</li>
<li>Your code in the callback function will be called when an interrupt event coming.</li>
</ol>
<h2><a class="anchor" id="CoX_Guide_Howto_Peripheral"></a>
1.4 How to Use the Peripheral?</h2>
<ol type="1">
<li>First of all, you should set the system clock using XSysCtlClockSet().</li>
</ol>
<ol type="1">
<li>If you use a peripheral such as SPI, you should enable the SPI clock and some GPIO clock before calling any SPI APIs. <div class="fragment"><div class="line"><a class="code" href="group__x_sys_ctl___exported___a_p_is.html#gaf622b54325597b6f01b58287ab6e1a8d" title="Enables a peripheral.">xSysCtlPeripheralEnable</a>(<a class="code" href="group__x_sys_ctl___peripheral___i_d.html#gaaca8c9df901ffe259a0c0dd68bf63649">xSYSCTL_PERIPH_SPI0</a>);</div>
<div class="line"><a class="code" href="group__x_sys_ctl___exported___a_p_is.html#gaf622b54325597b6f01b58287ab6e1a8d" title="Enables a peripheral.">xSysCtlPeripheralEnable</a>(<a class="code" href="group__x_g_p_i_o___exported___a_p_is.html#ga7b4b7cb545f2252099a5b85700b23884" title="Get the GPIO port from a Pin.">xGPIOSPinToPeripheralId</a>(FLASH_PIN_SPI_CLK));</div>
<div class="line"><a class="code" href="group__x_sys_ctl___exported___a_p_is.html#gaf622b54325597b6f01b58287ab6e1a8d" title="Enables a peripheral.">xSysCtlPeripheralEnable</a>(<a class="code" href="group__x_g_p_i_o___exported___a_p_is.html#ga7b4b7cb545f2252099a5b85700b23884" title="Get the GPIO port from a Pin.">xGPIOSPinToPeripheralId</a>(FLASH_PIN_SPI_CS));</div>
<div class="line"><a class="code" href="group__x_sys_ctl___exported___a_p_is.html#gaf622b54325597b6f01b58287ab6e1a8d" title="Enables a peripheral.">xSysCtlPeripheralEnable</a>(<a class="code" href="group__x_g_p_i_o___exported___a_p_is.html#ga7b4b7cb545f2252099a5b85700b23884" title="Get the GPIO port from a Pin.">xGPIOSPinToPeripheralId</a>(FLASH_PIN_SPI_MISO));</div>
<div class="line"><a class="code" href="group__x_sys_ctl___exported___a_p_is.html#gaf622b54325597b6f01b58287ab6e1a8d" title="Enables a peripheral.">xSysCtlPeripheralEnable</a>(<a class="code" href="group__x_g_p_i_o___exported___a_p_is.html#ga7b4b7cb545f2252099a5b85700b23884" title="Get the GPIO port from a Pin.">xGPIOSPinToPeripheralId</a>(FLASH_PIN_SPI_MOSI));</div>
</div><!-- fragment --></li>
</ol>
<ol type="1">
<li>Then you should config the SPI IO. <div class="fragment"><div class="line"><a class="code" href="group__x_g_p_i_o___exported___a_p_is.html#ga9ad51e5555febfee8633feb2f5fbf67c" title="Turn a pin to a GPIO SPI input or output pin.">xSPinTypeSPI</a>(<a class="code" href="group__x_g_p_i_o___peripheral___pin.html#ga07c06f1dec3826534d15b6a0f7e343e9">SPI2CLK</a>, FLASH_PIN_SPI_CLK);</div>
<div class="line"><a class="code" href="group__x_g_p_i_o___exported___a_p_is.html#ga9ad51e5555febfee8633feb2f5fbf67c" title="Turn a pin to a GPIO SPI input or output pin.">xSPinTypeSPI</a>(<a class="code" href="group__x_g_p_i_o___peripheral___pin.html#ga42f9b0a7840ec90515be8dea219333d2">SPI2MISO</a>, FLASH_PIN_SPI_MISO);</div>
<div class="line"><a class="code" href="group__x_g_p_i_o___exported___a_p_is.html#ga9ad51e5555febfee8633feb2f5fbf67c" title="Turn a pin to a GPIO SPI input or output pin.">xSPinTypeSPI</a>(<a class="code" href="group__x_g_p_i_o___peripheral___pin.html#gabd2d5c713e83d315c977b05afbb7800c">SPI2MOSI</a>, FLASH_PIN_SPI_MOSI); </div>
</div><!-- fragment --></li>
</ol>
<ol type="1">
<li>You can enable and initialize the SPI. <div class="fragment"><div class="line"><a class="code" href="group__x_s_p_i___exported___a_p_is.html#gaedae27c39b0a4ea654533650df36ee59" title="Enable the specified SPI port.">xSPIEnable</a>(FLASH_PIN_SPI_PORT);</div>
<div class="line"><a class="code" href="group__x_s_p_i___exported___a_p_is.html#ga97aaf06714cc0b6ca7831d711c7ab560" title="Configures the synchronous serial interface.">xSPIConfigSet</a>(FLASH_PIN_SPI_PORT, ulSpiClock, <a class="code" href="group__x_s_p_i___config.html#gad1f8ba41a892b9928a85bd1d20ce1bbe" title="Moto Format, polarity 0, phase 0.">xSPI_MOTO_FORMAT_MODE_0</a> |</div>
<div class="line">                                              <a class="code" href="group__x_s_p_i___config.html#gacfab81e935f8c815352666a2e1ad3ef5">xSPI_MODE_MASTER</a> | </div>
<div class="line">                                              <a class="code" href="group__x_s_p_i___config.html#ga0501bbc8dc242e3d044f28ae9a123f27">xSPI_MSB_FIRST</a> |</div>
<div class="line">                                              <a class="code" href="group__x_s_p_i___config.html#ga8370a146ad3d74e4a61732e9d468a0b6">xSPI_DATA_WIDTH8</a>); </div>
</div><!-- fragment --></li>
</ol>
<ol type="1">
<li>You can use SPI to communicate with a device.</li>
</ol>
<h2><a class="anchor" id="CoX_Guide_Howto_More_Portable"></a>
1.5 Make your code be ported more easily based on CoX</h2>
<p>Code based on CoX is convenient to port, but you can do more to make the code more portable.</p>
<p>For example: When using CoX SPI to write a SPI flash driver, we redefine the SPI base and shortpins. And then when need porting the code to other paltforms, We only need to change this defines. </p>
<div class="fragment"><div class="line"><span class="comment">//</span></div>
<div class="line"><span class="comment">// Define SPIx as a port connecting W25Xxx which can be configured</span></div>
<div class="line"><span class="comment">//</span></div>
<div class="line"><span class="preprocessor">#define FLASH_PIN_SPI_CLK       PD1</span></div>
<div class="line"><span class="preprocessor"></span><span class="preprocessor">#define FLASH_PIN_SPI_MISO      PD2</span></div>
<div class="line"><span class="preprocessor"></span><span class="preprocessor">#define FLASH_PIN_SPI_MOSI      PD3</span></div>
<div class="line"><span class="preprocessor"></span><span class="preprocessor">#define FLASH_PIN_SPI_PORT      SPI2_BASE</span></div>
<div class="line"><span class="preprocessor"></span><span class="comment">//</span></div>
<div class="line"><span class="comment">// Configure GPIOC.0 as chip Select</span></div>
<div class="line"><span class="comment">//</span></div>
<div class="line"><span class="preprocessor">#define FLASH_PIN_SPI_CS        PD0</span></div>
</div><!-- fragment --><h2><a class="anchor" id="CoX_Guide_Howto_Code_Standard"></a>
1.6. Code Standard in CoX</h2>
<h3><a class="anchor" id="CoX_Guide_Howto_Code_Name"></a>
1.6.1 Naming</h3>
<ul>
<li>An API function name is always like: Moudle + Nouns + verbs, such as SPIIntEnable(), <a class="el" href="group__x_g_p_i_o___exported___a_p_is.html#ga9dbba553de6cd348884c34a97dd2361b" title="Write a value to the specified pin.">xGPIOSPinWrite()</a> ....</li>
<li>A variable name is always with a prefix:<ul>
<li>unsigned long with a prefix ul, such as ulConfig;</li>
<li>unsigned char with a prefix uc, ucTemp;</li>
<li>A porter-type variables with prefix 'p', such as unsigned long *pulReadBuffer;</li>
<li>If the variable is global variable should plus an additional prefix "g_". such as unsigned long g_ulCalendar;</li>
</ul>
</li>
<li>source files name:<ul>
<li>CoX source file is always have a prefix 'x', such as <a class="el" href="xuart_8h.html" title="Prototypes for the UART Driver.">xuart.h</a>, xuart.c</li>
<li>The header file contains peripheral register info, always called xhw_moudle.h, such as xhw_uart.h.</li>
</ul>
</li>
</ul>
<h3><a class="anchor" id="CoX_Guide_Howto_Code_doxygen"></a>
1.6.2 Doxygen</h3>
<p>The presentment is using the doxygen standard.</p>
<p><br/>
 </p>
<h1><a class="anchor" id="CoX_Guide_Port"></a>
2. How to Port CoX to other MCU platforms?</h1>
<ol type="1">
<li>Download the blank template library.</li>
<li>Wirte the register info of the peripheral in the xhw_*.h.</li>
<li>Implement all the functions of the peripheral in the moudle.h/.c.</li>
<li>Port the APIs with the prefix 'x' based on the periperal functions you have implemented.</li>
<li>Test and write the doxygen documents.</li>
</ol>
<p>If you encounter any problems in the porting period, please contact us.</p>
<p><br/>
 <br/>
 </p>
</div></div><!-- contents -->
</div><!-- doc-content -->
<hr>
<address>
  <small>
    &copy;&nbsp;2009-2011 by CooCox - 
    visit <a href="http://www.coocox.org/">http://www.coocox.org/</a>
  </small>
</address>
</body>
</html>
